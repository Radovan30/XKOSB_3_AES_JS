<!DOCTYPE html>
<html lang="cs">
    <head>
        <meta charset="utf-8">
        <title>Steganografie / Šifrování AES / Hamming (7,4) / Simulace přenosu</title>
        <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1">
        <meta name="description" content="Vypracované úkoly do předmětu Metody kódování, šifrování a bezpečnosti dat.">
        <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
        <script src="https://rawgit.com/victornpb/f639f37373be0f6e82e1/raw/5d8f7ee8b32ae04de087d2377d8086e3389ee411/AES.js"></script>
    </head>
    <body>
        <div class="container pb-5">

            <!-- Nadpis -->
            <div class="page-header text-center p-4">
                <h1>Steganografie / Šifrování AES</h1>
                <h5>(KOSBD - 1. úkol / 2. úkol)</h5>
            </div>

            <!-- Přepínač mezi sekcemi -->
            <ul class="nav nav-tabs">
                <li class="nav-item">
                    <a class="nav-link" href="#encryptFile" data-toggle="tab" onclick="updateTitle(2)">Zašifrování souboru</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#decryptFile" data-toggle="tab" onclick="updateTitle(2)">Rozšifrování souboru</a>
                </li>
            </ul>
            <div id="my-tab-content" class="tab-content">

                <!-- Zakódování zprávy do obrázku s možností zašifrovnání -->
                <div class="tab-pane active" id="encodeMessage">
                    <div class="clearfix">

                        <h2 class="pt-3 pb-3">Zakódování zprávy do obrázku</h2>
                        <div class="alert alert-info text-justify pb-0">
                            <p>
                                Pro zakódování zprávy je potřeba nejprve vybrat libovolný obrázek ve formátu <strong>.JPG</strong>, <strong>.JPEG</strong> a <strong>.PNG bez průhledného pozadí</strong>, do kterého budeme zprávu zakódovávat.
                            </p>
                            <p>
                                Po výběru obrázku je potřeba zadat text zprávy, poté stačí zmáčknout tlačítko "<strong>Provést zakódování</strong>".
                            </p>
                            <p>
                                Pomocí funkcí v jazyce JavaScript proběhne zakódování zprávy do obrázku ve formátu <strong>.PNG</strong>, který poté stačí uložit do počítače pomocí pravého kliknutí myši na obrázek a "<strong>Uložit obrázek jako...</strong>".
                            </p>
                            <p>
                                <strong>Pozn.:</strong><br>
                                Nutno myslet na to, že čím <strong>větší</strong> bude obrázek a čím <strong>delší</strong> bude zpráva na vstupu, tím <strong>delší</strong> bude průběh zakódovávání a tím <strong>větší</strong> bude velikost výsledný obrázek mít.
                                Aplikace obsahuje řadu <strong>ošetření</strong> pro odchycení vyjímek a maximální zajištění funkčnosti.
                            </p>
                        </div>

                        <form class="form text-center">
                            <div class="form-group">
                                <input class="form-control-file border rounded-right" type="file" name="baseFile" onchange="previewEncodeImage()">
                            </div>
                            <div class="original d-none">
                                <h3 class="pt-1">Náhled vstupního obrázku</h3>
                                <canvas class="mw-100 pt-3 pb-4"></canvas>
                            </div>
                            <div class="form-group">
                                <textarea class="text-break form-control" id="message" rows="3" placeholder="Zde zadejte text vaší zprávy..." oninput="previewBinaryMessage()"></textarea>
                            </div>
                            <div class="form-group binary d-none">
                                <h3 class="pt-1 pb-2">Náhled binárního tvaru zprávy</h3>
                                <p class="text-break text-white rounded bg-dark p-3"></p>
                            </div>

                            <h2 class="text-justify pt-2 pb-3">Zašifrování zprávy</h2>
                            <div class="alert alert-info text-justify pb-0">
                                <p>
                                    Pro zašifrování zakódovávané zprávy do obrázku je potřeba nejprve vybrat obrázek dle požadavků uvedených v <strong>1. odstavci</strong>.
                                </p>
                                <p>
                                    Po výběru obrázku a zadání zprávy je třeba aktivovat šifrovací funkci <strong>zaškrtnutím pole pod odstavcem</strong>.
                                </p>
                                <p>
                                    Zvolíme si heslo pro zašifrování a po jeho ověření stačí pouze zmáčknout tlačítko "<strong>Provést zakódování se zašifrováním</strong>".
                                </p>
                                <p>
                                    <strong>Pozn.:</strong><br>
                                    Nutno myslet na to, že pro následné rozšifrování zprávy je nutné si <strong>pamatovat</strong> zvolené heslo při zašifrování.
                                    Rozšíření obsahuje řadu <strong>ošetření</strong> pro odchycení vyjímek a maximální zajištění funkčnosti.
                                </p>
                            </div>

                            <!-- Aktivace zašifrování -->
                            <h5 class="pt-2 pb-2 text-justify">
                                Aktivace rozšíření pro zašifrování
                            </h5>
                            <div class="form-group input-group">
                                <div class="input-group-prepend">
                                    <div class="input-group-text">
                                        <input type="checkbox" id="encryptAES" onclick="toggleEncryptAES()">
                                    </div>
                                </div>
                                <input type="text" class="form-control" id="encryptAESPassword" readonly oninput="previewKey()">
                            </div>
                            <div class="form-group encryptKey d-none">
                                <h3 class="pt-1 pb-2">Náhled číselného tvaru hesla na pozadí</h3>
                                <p class="text-break text-white rounded bg-dark p-3"></p>
                            </div>
                            <div class="form-group encryptMessage d-none">
                                <h3 class="pt-1 pb-2">Náhled zašifrované zprávy</h3>
                                <p class="text-break text-white rounded bg-dark p-3"></p>
                            </div>
                            <div class="form-group binaryEncryptMessage d-none">
                                <h3 class="pt-1 pb-2">Náhled binárního tvaru zašifrované zprávy</h3>
                                <p class="text-break text-white rounded bg-dark p-3"></p>
                            </div>
                            <div class="form-group">
                                <button type="button" class="btn btn-lg btn-info btn-block pt-3 pb-3" onclick="event.preventDefault(); encodeMessage()">Provést zakódování</button>
                            </div>
                        </form>
                    </div>

                    <div class="encoded text-center d-none">
                        <h3>Výstupní obrázek s tajnou zprávou</h3>
                        <canvas class="mw-100 pt-3 pb-3"></canvas>
                    </div>
                </div>

                <!-- Rozkódování zprávy z obrázku s možností rozšifrování -->
                <div class="tab-pane" id="decodeMessage">
                    <div class="clearfix">

                        <h2 class="pt-3 pb-3">Rozkódování zprávy z obrázku</h2>
                        <div class="alert alert-info text-justify pb-0">
                            <p>
                                Pro rozkódování zprávy je potřeba nejprve vybrat vstupní obrázek, ideálně se zakódovanou zprávou.
                            </p>
                            <p>
                                Po výběru obrázku stačí pouze zmáčknout tlačítko "<strong>Provést rozkódování</strong>".
                            </p>
                        </div>

                        <form class="form text-center">
                            <div class="form-group">
                                <input class="form-control-file border rounded-right" type="file" name="decodeFile" onchange="previewDecodeImage()">
                            </div>
                            <div class="decode d-none">
                                <h3 class="pt-1">Náhled vstupního obrázku</h3>
                                <canvas class="mw-100 pt-3 pb-4"></canvas>
                            </div>

                            <h2 class="text-justify pt-2 pb-3">Rozšifrování zprávy</h2>
                            <div class="alert alert-info text-justify pb-0">
                                <p>
                                    Pokud zpráva po rozkódování nedává smysl, je možné, že byla před vložením <strong>zašifrována</strong>.
                                </p>
                                <p>
                                    Pro rozšifrování zprávy je potřeba nejprve vybrat obrázek dle požadavků uvedených v <strong>1. odstavci</strong>.                                   
                                </p>
                                <p>
                                    Po výběru obrázku je třeba aktivovat rozšifrovací funkci <strong>zaškrtnutím pole pod odstavcem</strong>.
                                </p>
                                <p>
                                    Zadáme heslo, které bylo použito při zašifrování a poté stačí pouze zmáčknout tlačítko "<strong>Provést rozkódování s rozšifrováním</strong>".
                                </p>
                            </div>

                            <h5 class="pt-2 pb-2 text-justify">
                                Aktivace rozšíření pro rozšifrování
                            </h5>
                            <div class="form-group input-group">
                                <div class="input-group-prepend">
                                    <div class="input-group-text">
                                        <input type="checkbox" id="decryptAES" onclick="toggleDecryptAES()">
                                    </div>
                                </div>
                                <input type="text" class="form-control" id="decryptAESPassword" readonly onchange="$('.binary-decode').addClass('d-none')">
                            </div>
                            <div class="form-group">
                                <button class="btn btn-lg btn-info btn-block pt-3 pb-3" onclick="event.preventDefault(); decodeMessage()">Provést rozkódování</button>
                            </div>
                        </form>
                    </div>

                    <div class="binary-decode text-center d-none">
                        <h3 class="pt-3 pb-3">Výstupní zpráva</h3>
                        <textarea class="text-break form-control text-white bg-dark" rows="3" readonly></textarea>
                    </div>
                </div>

                <!-- Zašifrování souboru -->
                <div class="tab-pane" id="encryptFile">
                    <div class="clearfix">

                        <h2 class="pt-3 pb-3">Zašifrování souboru</h2>
                        <div class="alert alert-info text-justify pb-0">
                            <p>
                                Stejně tak, jako je možné šifrovat krátké <strong>zprávy</strong>, je možné šifrovat také celé <strong>soubory</strong>, které jsou tvořeny stejnými daty v podobě <strong>1</strong> a <strong>0</strong>.
                            </p>
                            <p>
                                Pro zašifrování určitého souboru je potřeba nejprve vybrat libovolný <strong>textový</strong> soubor ve formátu <strong>.TXT</strong>.
                            </p>
                            <p>
                                Po výběru souboru je potřeba zadat <strong>heslo</strong>, které bude pro zašifrování použito, poté stačí zmáčknout tlačítko "<strong>Provést zašifrování</strong>".
                            </p>
                            <p>
                                Pomocí funkcí v jazyce JavaScript proběhne zašifrování souboru s výstupem do formátu <strong>.TXT</strong>, který poté stačí uložit do počítače.
                            </p>
                            <p>
                                <strong>Pozn.:</strong><br>
                                Nutno myslet na to, že pro následné rozšifrování souboru bude nutné si <strong>pamatovat</strong> zvolené heslo při zašifrování.
                                Rozšíření obsahuje řadu <strong>ošetření</strong> pro odchycení vyjímek a maximální zajištění funkčnosti.
                            </p>
                        </div>

                        <form class="form text-center">
                            <div class="form-group">
                                <input class="form-control-file border rounded-right" type="file" name="encryptFile" onchange="$('#downloadEncryptedFile').addClass('d-none')">
                            </div>
                            <div class="form-group input-group">
                                <input type="text" class="form-control" id="encryptFileAESPassword" placeholder="Zde zadejte klíč pro zašifrování..." required onchange="$('#downloadEncryptedFile').addClass('d-none')">
                            </div>
                            <div class="form-group">
                                <button type="button" class="btn btn-lg btn-info btn-block pt-3 pb-3" onclick="event.preventDefault(); encodeFile()">Provést zašifrování</button>
                            </div>
                            <div class="form-group">
                                <div class="text-center rounded d-none bg-success p-3" id="downloadEncryptedFile"></div>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Rozšifrování souboru -->
                <div class="tab-pane" id="decryptFile">
                    <div class="clearfix">

                        <h2 class="pt-3 pb-3">Rozšifrování souboru</h2>
                        <div class="alert alert-info text-justify pb-0">
                            <p>
                                Pro rozšifrování určitého souboru je potřeba nejprve vybrat <strong>zašifrovaný</strong> textový soubor ve formátu <strong>.TXT</strong>.
                            </p>
                            <p>
                                Po výběru souboru je potřeba zadat <strong>heslo</strong>, které bude pro rozšifrování použito, poté stačí zmáčknout tlačítko "<strong>Provést rozšifrování</strong>".
                            </p>
                            <p>
                                Pomocí funkcí v jazyce JavaScript proběhne rozšifrování souboru s výstupem do formátu <strong>.TXT</strong>, který poté stačí uložit do počítače.
                            </p>
                        </div>

                        <form class="form text-center">
                            <div class="form-group">
                                <input class="form-control-file border rounded-right" type="file" name="decryptFile">
                            </div>
                            <div class="form-group input-group">
                                <input type="text" class="form-control" id="decryptFileAESPassword" placeholder="Zde zadejte klíč pro rozšifrování..." required>
                            </div>
                            <div class="form-group">
                                <button type="button" class="btn btn-lg btn-info btn-block pt-3 pb-3" onclick="event.preventDefault(); decodeFile()">Provést rozšifrování</button>
                            </div>
                            <div class="form-group">
                                <div class="text-center rounded d-none bg-success p-3" id="downloadDecryptedFile"></div>
                            </div>
                        </form>
                    </div>
                </div>

               
        <script>
            /* ==========================================: POMOCNÉ FUNKCE :========================================== */

            // Vizuální úprava nadpisu podle čísla úkolu.
            function updateTitle(id) {
                switch (id) {
                    case 1:
                        $(".page-header h1").text("Steganografie / Šifrování AES");
                        $(".page-header h5").text("(KOSBD - 1. úkol / 2. úkol)");
                        break;
                    case 2:
                        $(".page-header h1").text("Šifrování AES");
                        $(".page-header h5").text("(KOSBD - 2. úkol)");
                        break;
                    case 4:
                        $(".page-header h1").text("Hammingův kód (7,4)");
                        $(".page-header h5").text("(KOSBD - 4. úkol)");
                        break;
                    case 6:
                        $(".page-header h1").text("Simulace přenosu");
                        $(".page-header h5").text("(KOSBD - 6. úkol)");
                        break;
                }
            }

            // Kontrola nevybraného souboru na vstupu.
            function checkInputFile(id) {
                if ($("input[name=" + id + "]").get(0).files.length !== 0)
                    return 1;
                return;
            }

            // Kontrola prázdného textového pole na vstupu.
            function checkInputText(id) {
                if ($(id).val() !== "")
                    return 1;
                return;
            }

            // Kontrola přijatelných typů souboru na vstupu.
            function checkFileImage(file) {
                if ($.inArray(file["type"], ["image/jpg", "image/jpeg", "image/png"]) > 0)
                    return 1;
                return;
            }

            // Převod znaků ASCII do binární blokové podoby.
            function getBinaryMessage(text) {
                var out = "";
                for (var i = 0; i < text.length; i++) {
                    var char = text[i].charCodeAt(0).toString(2);
                    while (char.length < 8) {
                        char = "0" + char;
                    }
                    out += char;
                }
                return out;
            }

            // Převod binárního řetězce na znaky ASCII.
            function convertBinaryToString(binaryText) {
                var out = "";
                for (var i = 0; i < binaryText.length; i += 8) {
                    var c = 0;
                    for (var j = 0; j < 8; j++) {
                        c <<= 1;
                        c |= parseInt(binaryText[i + j]);
                    }
                    if (c !== 0) {
                        out += String.fromCharCode(c);
                    }
                }
                return out;
            }

            // Očištění textu od diakritiky.
            function removeDiacritic(text) {
                text = text.split("");
                var special = "ÁáÉéĚěÍíÓóÚúŮůÝýŽžŠšČčŘřČčĎďŤťŇň";
                var normal = "AaEeEeIiOoUuUuYyZzSsCcRrCcDdTtNn";
                var out = [];

                for (var i = 0; i < text.length; i++) {
                    if (special.indexOf(text[i]) !== -1) {
                        out[i] = normal.substr(special.indexOf(text[i]), 1);
                    } else
                        out[i] = text[i];
                }
                return out.join("");
            }

            // Kontrola průhlednosti u obrázku.
            function checkAlphaChannel(canvas, context) {
                var data = context.getImageData(0, 0, canvas[0].width, canvas[0].height).data;
                for (var i = 3; i < data.length; i += 4) {
                    if (data[i] === 0) {
                        return 1;
                    }
                }
                return;
            }

            // Převod znaků ASCII do číselné podoby.
            function convertPasswordIntoKey(input) {
                var out = "";

                // Cyklus pro převod všech znaků na ASCII hodnoty.
                for (var i = 0; i < input.length; i++) {
                    out += input[i].charCodeAt(0);
                }
                return out;
            }

            /* ==========================================: STEGANOGRAFIE :=========================================== */

            // Náhled textu v binárním tvaru.
            function previewBinaryMessage() {
                if (checkInputText("#message")) {
                    $(".binary p").text(getBinaryMessage(removeDiacritic($("#message").val())));
                    $(".binary").removeClass("d-none");
                    $(".encoded").addClass("d-none");

                    // Kontrola zapnutého šifrování.
                    if (checkInputText("#encryptAESPassword")) {
                        $(".binary").addClass("d-none");
                        previewKey();
                    }
                } else {
                    $(".encoded").addClass("d-none");
                    $(".binary").addClass("d-none");
                    $(".encryptMessage").addClass("d-none");
                    $(".binaryEncryptMessage").addClass("d-none");
                }
            }

            // Náhled originálního obrázku před zakódováním zprávy.
            function previewEncodeImage() {
                $(".original").addClass("d-none");
                if (checkInputFile("baseFile")) {
                    previewImage(document.querySelector("input[name=baseFile]").files[0], ".original canvas", function () {
                        $(".original").removeClass("d-none");
                    });
                }
            }

            // Náhled obrázku se zakódovanou zprávou.
            function previewDecodeImage() {
                $(".decode").addClass("d-none");
                $(".binary-decode").addClass("d-none");
                if (checkInputFile("decodeFile")) {
                    previewImage(document.querySelector("input[name=decodeFile]").files[0], ".decode canvas", function () {
                        $(".decode").removeClass("d-none");
                    });
                } else {
                    $(".decode").addClass("d-none");
                }
            }

            // Vygenerování náhledu obrázku.
            function previewImage(file, canvasSelector, callback) {
                var context = $(canvasSelector)[0].getContext("2d");
                var reader = new FileReader();
                var image = new Image;

                // Kontrola formátu vstupního obrázku.
                if (!checkFileImage(file)) {
                    window.alert("Vybraný soubor není v platném vstupním formátu!");
                    document.querySelector("input[name=decodeFile]").value = "";
                    document.querySelector("input[name=baseFile]").value = "";
                    return;
                }

                reader.readAsDataURL(file);
                reader.onloadend = function () {
                    image.src = URL.createObjectURL(file);
                    image.onload = function () {
                        $(canvasSelector).prop({
                            "width": image.width,
                            "height": image.height
                        });
                        context.drawImage(image, 0, 0);
                        callback();
                    };
                };
            }

            // Zakódování zprávy do obrázku.
            function encodeMessage() {

                // Kontrola obrázku na vstupu.
                if (!checkInputFile("baseFile")) {
                    window.alert("Nebyl detekován obrázek na vstupu!");
                    return;
                }

                // Vstupní obrázek.
                var originalCanvas = $(".original canvas");
                var originalContext = originalCanvas[0].getContext("2d");

                var height = originalCanvas[0].height;
                var width = originalCanvas[0].width;

                // Kontrola průhledného pozadí u obrázku na vstupu.
                if (checkAlphaChannel(originalCanvas, originalContext)) {
                    window.alert("Obrázek na vstupu nelze použít, protože obsahuje průhledné pozadí!");
                    return;
                }

                // Kontrola zprávy na vstupu.
                if (!checkInputText("#message")) {
                    window.alert("Nebyla detekována zpráva na vstupu!");
                    return;
                }

                // Text na vstupu.
                var text = removeDiacritic($("#message").val());

                // Kontrola existence zašifrovaného textu.
                if (cipher !== "") {
                    text = cipher;
                }

                // Klíčová kontrola schopnosti obrázku pojmout zakódovaný formát zprávy.
                if ((text.length * 8) > (width * height * 3)) {
                    window.alert("Zpráva je pro vybraný vstupní obrázek příliš dlouhá!");
                    return;
                }

                // Pomocné plátno pro upravený vstupní obrázek.
                var normalizedCanvas = document.createElement("canvas");
                normalizedCanvas.height = height;
                normalizedCanvas.width = width;
                var normalizedContext = normalizedCanvas.getContext("2d");

                // Cyklus pro úpravu vstupního obrázku.
                var normalized = originalContext.getImageData(0, 0, width, height);

                // Cyklus pro úpravu RGB dat vstupního obrázku tak, aby byly hodnoty kanálů RGB sudé.
                for (var i = 0; i < normalized.data.length; i += 4) {
                    for (var j = 0; j < 3; j++) {
                        if (normalized.data[i + j] % 2 !== 0) {
                            normalized.data[i + j]--;
                        }
                    }
                }
                normalizedContext.putImageData(normalized, 0, 0);

                // Kontrolní výpis upravených vstupních obrazových dat.
                console.info("Upravené RGBA hodnoty vstupního obrázku:");
                console.info(normalized.data);

                // Výstupní plátno.
                var messageCanvas = $(".encoded canvas");
                messageCanvas.prop({
                    "width": width,
                    "height": height
                });
                var messageContext = messageCanvas[0].getContext("2d");

                // Cylus pro vložení zprávy v binárním tvaru do upraveného vstupního obrázku.
                var message = normalizedContext.getImageData(0, 0, width, height);
                for (var c = 0, i = 0; i < message.data.length; i += 4) {
                    for (var j = 0; j < 3; j++) {
                        if (c < getBinaryMessage(text).length) {
                            message.data[i + j] += parseInt(getBinaryMessage(text)[c]);
                            c++;
                        } else {
                            break;
                        }
                    }
                }
                messageContext.putImageData(message, 0, 0);
                $(".encoded").removeClass("d-none");

                // Kontrolní výpis obrazových dat se zakódovanou zprávou.
                console.info("RGBA hodnoty vstupního obrázku s vloženou zprávou:");
                console.info(message.data);
            }

            // Rozkódování zprávy z obrázku.
            function decodeMessage() {

                // Kontrola obrázku na vstupu.
                if (!checkInputFile("decodeFile")) {
                    window.alert("Nebyl detekován obrázek na vstupu!");
                    return;
                }

                // Vstupní obrázek.
                var originalCanvas = $(".decode canvas");
                var originalContext = originalCanvas[0].getContext("2d");

                // Kontrola průhledného pozadí u obrázku na vstupu.
                if (checkAlphaChannel(originalCanvas, originalContext)) {
                    window.alert("Obrázek na vstupu nelze použít, protože obsahuje průhledné pozadí!");
                    return;
                }

                // Cyklus pro získání zakódované zprávy ze vstupního obrázku.
                var message = originalContext.getImageData(0, 0, originalCanvas.width(), originalCanvas.height());
                var binary = "";
                for (var i = 0; i < message.data.length; i += 4) {
                    for (var j = 0; j < 3; j++) {
                        if (message.data[i + j] % 2 !== 0) {
                            binary += 1;
                        } else {
                            binary += 0;
                        }
                    }
                }

                // Kontrolní výpis získáné binární zprávy.
                console.info("Binární tvar zprávy:");
                console.info(binary);

                // Získání původního tvaru zprávy.
                message = convertBinaryToString(binary);
                console.info(message);

                // Klíčová kontrola aktivní rozšifrovací funkce s rozšifrováním.
                if (checkInputText("#decryptAESPassword")) {
                    var password = convertPasswordIntoKey(removeDiacritic($("#decryptAESPassword").val()));
                    message = Aes.Ctr.decrypt(message, password, 128);
                }

                // Výpis konečné zprávy.
                $(".binary-decode textarea").text(message);
                $(".binary-decode").removeClass("d-none");
            }

            /* ==========================================: AES ŠIFROVÁNÍ :=========================================== */

            // Klíčová proměnná se zašifrovanou zprávou pro lepší manipulaci napříč funkcemi.
            var cipher = "";

            // Zpřístupnění pole pro zadání klíče k zašifrování.
            function toggleEncryptAES() {
                if ($("#encryptAES").prop("checked")) {
                    $("#encryptAESPassword").attr("required", 1);
                    $("#encryptAESPassword").removeAttr("readonly");
                    $("#encryptAESPassword").attr("placeholder", "Zde zadejte klíč pro zašifrování...");
                    $("#encodeMessage button").text("Provést zakódování se zašifrováním");
                } else {
                    $("#encryptAESPassword").attr("placeholder", "");
                    $("#encryptAESPassword").removeAttr("required");
                    $("#encryptAESPassword").attr("readonly", 1);
                    $("#encryptAESPassword").val("");
                    $("#encodeMessage button").text("Provést zakódování");
                    $(".encryptKey").addClass("d-none");
                    $(".encryptMessage").addClass("d-none");
                    $(".binaryEncryptMessage").addClass("d-none");
                    cipher = "";

                    if (checkInputText("#message")) {
                        $(".binary").removeClass("d-none");
                    }
                }
            }

            // Zpřístupnění pole pro zadání klíče k rozšifrování.
            function toggleDecryptAES() {
                if ($("#decryptAES").prop("checked")) {
                    $("#decryptAESPassword").attr("required", 1);
                    $("#decryptAESPassword").removeAttr("readonly");
                    $("#decryptAESPassword").attr("placeholder", "Zde zadejte klíč pro rozšifrování...");
                    $("#decodeMessage button").text("Provést rozkódování s rozšifrováním");
                } else {
                    $("#decryptAESPassword").attr("placeholder", "");
                    $("#decryptAESPassword").removeAttr("required");
                    $("#decryptAESPassword").attr("readonly", 1);
                    $("#decryptAESPassword").val("");
                    $("#decodeMessage button").text("Provést rozkódování");
                    $(".binary-decode").addClass("d-none");
                }
            }

            // Zašifrovaného vstupního textu.
            function previewKey() {

                // Kontrola zadaného hesla.
                if (checkInputText("#encryptAESPassword")) {
                    var password = convertPasswordIntoKey(removeDiacritic($("#encryptAESPassword").val()));
                    var message = removeDiacritic($("#message").val());

                    // Výpis číselného tvaru vstupního hesla.
                    $(".encryptKey p").text(password);
                    $(".encryptKey").removeClass("d-none");
                    if (checkInputText("#encryptAESPassword") && checkInputText("#message")) {

                        // Klíčová proměnná se zašifrovaným textem na vstupu.
                        cipher = Aes.Ctr.encrypt(message, password, $(128,));

                        // Výpis zašifrovaného tvaru zprávy.
                        $(".encryptMessage p").text(cipher);
                        $(".encryptMessage").removeClass("d-none");

                        // Binární výpis zašifrované zprávy
                        $(".binaryEncryptMessage p").text(getBinaryMessage(cipher));
                        $(".binaryEncryptMessage").removeClass("d-none");
                        $(".binary").addClass("d-none");

                        // Kontrolní výpis získané zprávy z obrázku.
                        console.info("Originální znění zprávy: " + Aes.Ctr.decrypt(cipher, password, 128));
                        console.info(cipher);
                    } else {
                        $(".encryptMessage").addClass("d-none");
                        $(".binaryEncryptMessage").addClass("d-none");
                    }
                } else {
                    $(".encryptKey").addClass("d-none");
                    $(".encryptMessage").addClass("d-none");
                    $(".binaryEncryptMessage").addClass("d-none");
                    cipher = "";

                    if (checkInputText("#message")) {
                        $(".binary").removeClass("d-none");
                    }
                }
            }

            // Zašifrování textového souboru na vstupu.
            function encodeFile() {

                // Kontrola souboru na vstupu.
                if (!checkInputFile("encryptFile")) {
                    window.alert("Nebyl detekován soubor na vstupu!");
                    document.querySelector("input[name=encryptFile]").value = "";
                    $("#downloadEncryptedFile").addClass("d-none");
                    return;
                }

                // Inicializace souboru na vstupu.
                var file = document.querySelector("input[name=encryptFile]").files[0];

                // Podmínka pro kontrolu podporovaného formátu souboru na vstupu.
                if (file.name.split(".").pop() === "txt") {

                    // Kontrola hesla pro zašifrování
                    if (!checkInputText("#encryptFileAESPassword")) {
                        window.alert("Je potřeba zadat heslo pro zašifrování!");
                        return;
                    }

                    // Inicializace hesla pro zašifrování na vstupu.
                    var password = convertPasswordIntoKey(removeDiacritic($("#encryptFileAESPassword").val()));

                    var reader = new FileReader();
                    reader.onload = function (e) {

                        // Získání obsahu souboru.
                        var content = "";
                        var bytes = new Uint8Array(reader.result);
                        for (var i = 0; i < bytes.byteLength; i++) {
                            content += String.fromCharCode(bytes[i]);
                        }

                        // Kontrolní výpis znakové reprezentace souboru.
                        console.info("Datový obsah souboru: ");
                        console.info(content);

                        // Klíčové zašifrování souboru.
                        var cipher = Aes.Ctr.encrypt(content, password, 128);

                        // Kontrolní výpis znakové reprezentace souboru.
                        console.info("Zašifrovaný obsah souboru: ");
                        console.info(cipher);

                        // Sestavení výstupního textového souboru se zašifrovanými daty.
                        var blob = new Blob([cipher], {type: "text/plain"});
                        $("#downloadEncryptedFile").html("<a class='text-white' href='" + URL.createObjectURL(blob) + "' download='encrypted_" + file.name + "'><strong>Stáhnout zašifrovaný soubor</strong></href>");
                        $("#downloadEncryptedFile").removeClass("d-none");
                    };
                    reader.readAsArrayBuffer(file);
                } else {
                    window.alert("Formát zvoleného souboru na vstupu není podporován!");
                    document.querySelector("input[name=encryptFile]").value = "";
                    $("#downloadEncryptedFile").addClass("d-none");
                }
            }

            // Rozšifrování textového souboru na vstupu.
            function decodeFile() {

                // Kontrola souboru na vstupu.
                if (!checkInputFile("decryptFile")) {
                    window.alert("Nebyl detekován soubor na vstupu!");
                    document.querySelector("input[name=decryptFile]").value = "";
                    $("#downloadDecryptedFile").addClass("d-none");
                    return;
                }

                // Inicializace souboru na vstupu.
                var file = document.querySelector("input[name=decryptFile]").files[0];

                // Podmínka pro kontrolu podporovaného formátu souboru na vstupu.
                if (file.name.split(".").pop() === "txt") {

                    // Kontrola hesla pro rozšifrování
                    if (!checkInputText("#decryptFileAESPassword")) {
                        window.alert("Je potřeba zadat heslo pro rozšifrování!");
                        return;
                    }

                    // Inicializace hesla pro rozšifrování na vstupu.
                    var password = convertPasswordIntoKey(removeDiacritic($("#decryptFileAESPassword").val()));

                    var reader = new FileReader();
                    reader.readAsText(file);
                    reader.onload = function (e) {

                        // Rozšifrování získaných dat souboru.
                        var data = Aes.Ctr.decrypt(reader.result, password, 128);

                        // Převod znaků na použitelný stream do souboru.
                        var bytes = new Uint8Array(data.length);
                        for (var i = 0; i < data.length; i++) {
                            bytes[i] = data.charCodeAt(i);
                        }

                        // Sestavení výstupního textového souboru s rozšifrovanými daty.
                        var blob = new Blob([bytes], {type: "text/plain"});
                        $("#downloadDecryptedFile").html("<a class='text-white' href='" + URL.createObjectURL(blob) + "' download='decrypted_" + file.name + "'><strong>Stáhnout rozšifrovaný soubor</strong></href>");
                        $("#downloadDecryptedFile").removeClass("d-none");
                    };
                } else {
                    window.alert("Formát zvoleného souboru na vstupu není podporován!");
                    document.querySelector("input[name=decryptFile]").value = "";
                    $("#downloadDecryptedFile").addClass("d-none");
                }
            }

           
            
        </script>
    </body>
</html>